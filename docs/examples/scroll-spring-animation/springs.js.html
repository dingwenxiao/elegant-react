<!DOCTYPE html>
<html>
<head>
  <title>springs.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../", thisFile = "examples/scroll-spring-animation/springs.js", defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>springs.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
<p>copied and modified from <a href='https://raw.githubusercontent.com/threepointone/react-springs/master/src.js'>https://raw.githubusercontent.com/threepointone/react-springs/master/src.js</a>
because react-native support breaks the build process</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>try{ React = require('react-native'); }
catch(e){ React = require('react'); }
the above bit should get better after <a href='https://github.com/facebook/react/issues/3220'>https://github.com/facebook/react/issues/3220</a></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>springs, all that</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kr">import</span> <span class="nx">rebound</span> <span class="nx">from</span> <span class="s1">&#39;rebound&#39;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">noop</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{};</span> <span class="c1">// default onSpringUpdate</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">Spring</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">getDefaultProps</span><span class="p">(){</span>
    <span class="k">return</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>we use a common 'global' springSystem for perf, but you can pass in your own</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">springSystem</span><span class="o">:</span> <span class="k">new</span> <span class="nx">rebound</span><span class="p">.</span><span class="nx">SpringSystem</span><span class="p">(),</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>from and to are analogous to setCurrentValue() and setEndValue()</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">from</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">to</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>more rebound options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">tension</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
      <span class="nx">friction</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="nx">overShootClamping</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">atRest</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">onSpringUpdate</span><span class="o">:</span> <span class="nx">noop</span><span class="p">,</span>
      <span class="nx">onSpring</span><span class="o">:</span> <span class="nx">noop</span><span class="p">,</span>
      <span class="nx">children</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kc">null</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>todo - velocity?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="p">};</span>
  <span class="p">},</span>

  <span class="nx">propTypes</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">from</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">number</span><span class="p">,</span>
    <span class="nx">friction</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">number</span><span class="p">,</span>
    <span class="nx">tension</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">number</span><span class="p">,</span>
    <span class="nx">to</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">number</span><span class="p">,</span>
    <span class="nx">atRest</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">bool</span><span class="p">,</span>
    <span class="nx">overShootClamping</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">bool</span><span class="p">,</span>
    <span class="nx">children</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">,</span>
    <span class="nx">onSpringUpdate</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">,</span>
    <span class="nx">onSpring</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span>
  <span class="p">},</span>

  <span class="nx">statics</span><span class="o">:</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>high perf "setters",</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">friction</span><span class="p">(</span><span class="nx">spring</span><span class="p">,</span> <span class="nx">props</span><span class="p">){</span>
      <span class="nx">spring</span><span class="p">.</span><span class="nx">getSpringConfig</span><span class="p">().</span><span class="nx">friction</span> <span class="o">=</span>
        <span class="nx">rebound</span><span class="p">.</span><span class="nx">OrigamiValueConverter</span><span class="p">.</span><span class="nx">frictionFromOrigamiValue</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">friction</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">tension</span><span class="p">(</span><span class="nx">spring</span><span class="p">,</span> <span class="nx">props</span><span class="p">){</span>
      <span class="nx">spring</span><span class="p">.</span><span class="nx">getSpringConfig</span><span class="p">().</span><span class="nx">tension</span> <span class="o">=</span>
        <span class="nx">rebound</span><span class="p">.</span><span class="nx">OrigamiValueConverter</span><span class="p">.</span><span class="nx">frictionFromOrigamiValue</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">tension</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">from</span><span class="p">(</span><span class="nx">spring</span><span class="p">,</span> <span class="nx">props</span><span class="p">){</span>
      <span class="nx">spring</span><span class="p">.</span><span class="nx">setCurrentValue</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">from</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">setEndValue</span><span class="p">(</span><span class="nx">spring</span><span class="p">.</span><span class="nx">getEndValue</span><span class="p">());</span>
    <span class="p">},</span>
    <span class="nx">overShootClamping</span><span class="p">(</span><span class="nx">spring</span><span class="p">,</span> <span class="nx">props</span><span class="p">){</span>
      <span class="nx">spring</span><span class="p">.</span><span class="nx">setOvershootClampingEnabled</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">overShootClamping</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">to</span><span class="p">(</span><span class="nx">spring</span><span class="p">,</span> <span class="nx">props</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">atRest</span><span class="p">){</span>
        <span class="nx">spring</span><span class="p">.</span><span class="nx">setCurrentValue</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">to</span><span class="p">).</span><span class="nx">setAtRest</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">else</span><span class="p">{</span>
        <span class="nx">spring</span><span class="p">.</span><span class="nx">setEndValue</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">to</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">accept</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">initial</span><span class="p">){</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">props</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">k</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">Spring</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">initial</span> <span class="o">||</span> <span class="p">(</span><span class="nx">props</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">[</span><span class="nx">k</span><span class="p">]))){</span>
        <span class="nx">Spring</span><span class="p">[</span><span class="nx">k</span><span class="p">](</span><span class="k">this</span><span class="p">.</span><span class="nx">spring</span><span class="p">,</span> <span class="nx">props</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">},</span>

  <span class="nx">shouldComponentUpdate</span><span class="p">(){</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>components with 'render callbacks' can/should render 'through'.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="p">},</span>

  <span class="nx">getInitialState</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">value</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">from</span>
    <span class="p">};</span>
  <span class="p">},</span>

  <span class="nx">componentWillMount</span><span class="p">()</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>create the spring on mounting.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">spring</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">springSystem</span><span class="p">.</span><span class="nx">createSpring</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">tension</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">friction</span><span class="p">).</span><span class="nx">addListener</span><span class="p">({</span>
      <span class="nx">onSpringUpdate</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">value</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">spring</span><span class="p">.</span><span class="nx">getCurrentValue</span><span class="p">()</span> <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onSpringUpdate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">spring</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onSpring</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">spring</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">accept</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">componentWillReceiveProps</span><span class="p">(</span><span class="nx">nextProps</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">accept</span><span class="p">(</span><span class="nx">nextProps</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>...and destroy on onmounting</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">spring</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">spring</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onSpring</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">render</span><span class="p">(){</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">Springs</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">getDefaultProps</span><span class="p">(){</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">onSpringUpdate</span><span class="o">:</span> <span class="nx">noop</span><span class="p">,</span>
      <span class="nx">onSpring</span><span class="o">:</span> <span class="nx">noop</span><span class="p">,</span>
      <span class="nx">children</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kc">null</span>
    <span class="p">};</span>
  <span class="p">},</span>

  <span class="nx">propTypes</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">onSpringUpdate</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">,</span>
    <span class="nx">onSpring</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">,</span>
    <span class="nx">children</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span>
  <span class="p">},</span>

  <span class="nx">shouldComponentUpdate</span><span class="p">(){</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>like above</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="p">},</span>
  <span class="nx">onSpringUpdate</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">spring</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">:</span> <span class="nx">spring</span><span class="p">.</span><span class="nx">getCurrentValue</span><span class="p">()</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onSpringUpdate</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">spring</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">to</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">value</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">let</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Spring</span> <span class="p">{...</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">}</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">key</span><span class="p">}</span> <span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="nx">pos</span><span class="p">[</span><span class="nx">key</span><span class="p">]}</span> <span class="nx">onSpring</span><span class="o">=</span><span class="p">{</span><span class="nx">spring</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onSpring</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">spring</span><span class="p">)}</span> <span class="nx">onSpringUpdate</span><span class="o">=</span><span class="p">{</span><span class="nx">spring</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">onSpringUpdate</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">spring</span><span class="p">)}</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">value</span><span class="p">))}</span>
    <span class="o">&lt;</span><span class="err">/Spring&gt;;</span>
  <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>todo - sort keys alphabetically?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>what we do here, is break <code>to</code> into key value pairs, and then return a nest of <Spring>s
React takes care of the boring bits (caching, state, etc)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">let</span> <span class="p">{</span><span class="nx">to</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">,</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">to</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{});</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
